<!DOCTYPE html>
<html>
<head>
    <title>Authentification Steam pour GMOD</title>
    <meta charset="utf-8">
</head>
<body>
    <div id="status">Vérification de l'authentification Steam...</div>

    <script>
        // Fonction principale d'authentification
        async function processSteamAuth() {
            const statusElement = document.getElementById('status');
            
            try {
                // 1. Vérifier si nous sommes sur une redirection de Steam
                const params = new URLSearchParams(window.location.search);
                const steamIdentity = params.get('openid.identity');
                
                // Si pas de paramètres Steam, c'est la page d'accueil
                if (!steamIdentity) {
                    statusElement.textContent = "Page d'authentification prête. Utilisez cette URL dans votre addon GMOD.";
                    return;
                }
                
                // 2. Extraire le SteamID64 de l'identité Steam
                const steamID64 = steamIdentity.split('/').pop();
                statusElement.textContent = `Authentification réussie pour SteamID: ${steamID64}`;
                
                // 3. Créer un jeton d'authentification (simple dans cet exemple, à améliorer en production)
                const timestamp = Date.now();
                const token = btoa(`${steamID64}:${timestamp}:votre_sel_secret`);
                
                // 4. Rediriger vers GMOD avec le protocole personnalisé
                // Vous pouvez aussi utiliser localStorage et un mécanisme de polling
                setTimeout(() => {
                    window.location.href = `gmod://auth/${token}/${steamID64}`;
                    
                    // Message pour les utilisateurs
                    statusElement.textContent = "Redirection vers GMOD... Cliquez sur 'Ouvrir' si une boîte de dialogue apparaît.";
                }, 1500);
                
            } catch (error) {
                statusElement.textContent = `Erreur: ${error.message}`;
                console.error(error);
            }
        }

        // Exécuter au chargement
        window.onload = processSteamAuth;
    </script>
</body>
</html>